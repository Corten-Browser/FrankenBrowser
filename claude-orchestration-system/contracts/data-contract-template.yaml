---
# Data Contract for {{COMPONENT_NAME}}
# Version: {{API_VERSION}}
# {{COMPONENT_DESCRIPTION}}

metadata:
  name: {{COMPONENT_NAME}}
  version: {{API_VERSION}}
  owner: {{OWNER_TEAM}}
  contact: {{CONTACT_EMAIL}}
  description: {{COMPONENT_DESCRIPTION}}
  tags:
    - {{TAG_1}}
    - {{TAG_2}}
  last_updated: "{{LAST_UPDATED}}"

# ============================================================================
# Database Schema
# ============================================================================

database:
  type: {{DB_TYPE}}  # postgresql, mysql, mongodb, cassandra, etc.
  name: {{DB_NAME}}
  schema: {{SCHEMA_NAME}}  # For SQL databases

  connection:
    host: {{DB_HOST}}
    port: {{DB_PORT}}
    ssl: true
    pool_size: {{POOL_SIZE}}
    timeout: {{TIMEOUT}}

  tables:
    - name: {{TABLE_NAME}}
      description: {{TABLE_DESCRIPTION}}

      columns:
        - name: id
          type: UUID
          constraints:
            - PRIMARY KEY
            - NOT NULL
          description: Unique identifier

        - name: created_at
          type: TIMESTAMP
          constraints:
            - NOT NULL
            - DEFAULT CURRENT_TIMESTAMP
          description: Creation timestamp

        - name: updated_at
          type: TIMESTAMP
          constraints:
            - NOT NULL
            - DEFAULT CURRENT_TIMESTAMP
            - ON UPDATE CURRENT_TIMESTAMP
          description: Last update timestamp

        - name: deleted_at
          type: TIMESTAMP
          constraints:
            - NULLABLE
          description: Soft delete timestamp

        # Add domain-specific columns
        {{TABLE_COLUMNS}}

      indexes:
        - name: idx_{{TABLE_NAME}}_created_at
          columns: [created_at]
          type: BTREE

        - name: idx_{{TABLE_NAME}}_deleted_at
          columns: [deleted_at]
          type: BTREE
          where: deleted_at IS NULL

        # Add domain-specific indexes
        {{TABLE_INDEXES}}

      constraints:
        - type: UNIQUE
          columns: {{UNIQUE_COLUMNS}}

        - type: FOREIGN_KEY
          columns: {{FK_COLUMNS}}
          references:
            table: {{FK_TABLE}}
            columns: {{FK_REF_COLUMNS}}
            on_delete: {{FK_ON_DELETE}}  # CASCADE, SET NULL, RESTRICT
            on_update: {{FK_ON_UPDATE}}

        # Add domain-specific constraints
        {{TABLE_CONSTRAINTS}}

      partitioning:
        enabled: {{PARTITIONING_ENABLED}}
        type: {{PARTITION_TYPE}}  # RANGE, LIST, HASH
        column: {{PARTITION_COLUMN}}
        interval: {{PARTITION_INTERVAL}}  # For time-based partitioning

      retention:
        enabled: {{RETENTION_ENABLED}}
        period: {{RETENTION_PERIOD}}  # e.g., "90 days", "1 year"
        strategy: {{RETENTION_STRATEGY}}  # soft_delete, hard_delete, archive

# ============================================================================
# Data Access Patterns
# ============================================================================

access_patterns:
  - name: get_by_id
    description: Retrieve record by primary key
    type: point_query
    frequency: high
    query: |
      SELECT * FROM {{TABLE_NAME}}
      WHERE id = :id
      AND deleted_at IS NULL
    indexes_used:
      - PRIMARY KEY
    expected_latency_ms: 5

  - name: list_recent
    description: List recent records with pagination
    type: range_query
    frequency: high
    query: |
      SELECT * FROM {{TABLE_NAME}}
      WHERE deleted_at IS NULL
      ORDER BY created_at DESC
      LIMIT :limit OFFSET :offset
    indexes_used:
      - idx_{{TABLE_NAME}}_created_at
    expected_latency_ms: 20

  - name: search_by_criteria
    description: Search with filtering
    type: filtered_query
    frequency: medium
    query: |
      SELECT * FROM {{TABLE_NAME}}
      WHERE {{SEARCH_CONDITIONS}}
      AND deleted_at IS NULL
      LIMIT :limit
    indexes_used:
      - {{SEARCH_INDEXES}}
    expected_latency_ms: 50

  # Add domain-specific access patterns
  {{ACCESS_PATTERNS}}

# ============================================================================
# Data Quality Rules
# ============================================================================

quality:
  validation:
    - field: {{FIELD_NAME}}
      rules:
        - type: not_null
          severity: error
        - type: format
          pattern: {{VALIDATION_PATTERN}}
          severity: error
        - type: range
          min: {{MIN_VALUE}}
          max: {{MAX_VALUE}}
          severity: warning
        - type: enum
          values: {{ALLOWED_VALUES}}
          severity: error

    # Add domain-specific validation rules
    {{VALIDATION_RULES}}

  completeness:
    - metric: non_null_rate
      field: {{FIELD_NAME}}
      threshold: 0.99
      severity: warning

    - metric: fill_rate
      field: {{FIELD_NAME}}
      threshold: 0.95
      severity: warning

  accuracy:
    - metric: unique_rate
      field: {{UNIQUE_FIELD}}
      threshold: 1.0
      severity: error

    - metric: reference_integrity
      field: {{FK_FIELD}}
      reference_table: {{REF_TABLE}}
      threshold: 1.0
      severity: error

  consistency:
    - metric: cross_field_consistency
      fields: [{{FIELD_1}}, {{FIELD_2}}]
      rule: {{CONSISTENCY_RULE}}
      threshold: 1.0
      severity: warning

  timeliness:
    - metric: data_freshness
      field: updated_at
      max_age: {{MAX_AGE}}
      severity: warning

    - metric: processing_lag
      expected_lag: {{EXPECTED_LAG}}
      severity: warning

# ============================================================================
# Data Transformations
# ============================================================================

transformations:
  - name: {{TRANSFORMATION_NAME}}
    description: {{TRANSFORMATION_DESCRIPTION}}
    type: {{TRANSFORMATION_TYPE}}  # ETL, ELT, stream
    source:
      type: {{SOURCE_TYPE}}
      location: {{SOURCE_LOCATION}}
      format: {{SOURCE_FORMAT}}

    destination:
      type: {{DEST_TYPE}}
      location: {{DEST_LOCATION}}
      format: {{DEST_FORMAT}}

    schedule:
      type: {{SCHEDULE_TYPE}}  # cron, event, continuous
      expression: {{SCHEDULE_EXPRESSION}}

    mappings:
      - source_field: {{SOURCE_FIELD}}
        destination_field: {{DEST_FIELD}}
        transformation: {{TRANSFORMATION_LOGIC}}

      # Add field mappings
      {{FIELD_MAPPINGS}}

    validation:
      pre_validation: {{PRE_VALIDATION_CHECKS}}
      post_validation: {{POST_VALIDATION_CHECKS}}

# ============================================================================
# Data Lineage
# ============================================================================

lineage:
  upstream:
    - name: {{UPSTREAM_SOURCE}}
      type: {{UPSTREAM_TYPE}}  # database, api, file, stream
      description: {{UPSTREAM_DESCRIPTION}}
      refresh_rate: {{UPSTREAM_REFRESH}}

  downstream:
    - name: {{DOWNSTREAM_CONSUMER}}
      type: {{DOWNSTREAM_TYPE}}
      description: {{DOWNSTREAM_DESCRIPTION}}
      dependency: {{DEPENDENCY_TYPE}}  # critical, important, optional

# ============================================================================
# SLA (Service Level Agreement)
# ============================================================================

sla:
  availability:
    target: 99.9  # percentage
    measurement_window: 30d

  performance:
    read_latency_p95: {{READ_P95}}  # milliseconds
    write_latency_p95: {{WRITE_P95}}
    query_timeout: {{QUERY_TIMEOUT}}

  data_quality:
    completeness: 99.0  # percentage
    accuracy: 99.5
    freshness: {{FRESHNESS_REQUIREMENT}}

  backup:
    frequency: {{BACKUP_FREQUENCY}}  # daily, hourly, etc.
    retention: {{BACKUP_RETENTION}}
    recovery_time_objective: {{RTO}}
    recovery_point_objective: {{RPO}}

# ============================================================================
# Security & Privacy
# ============================================================================

security:
  encryption:
    at_rest: {{ENCRYPTION_AT_REST}}
    in_transit: {{ENCRYPTION_IN_TRANSIT}}
    algorithm: {{ENCRYPTION_ALGORITHM}}

  access_control:
    authentication: {{AUTH_METHOD}}
    authorization: {{AUTHZ_METHOD}}

    roles:
      - name: {{ROLE_NAME}}
        permissions:
          - {{PERMISSION_1}}
          - {{PERMISSION_2}}

  pii_fields:
    - field: {{PII_FIELD}}
      classification: {{PII_CLASSIFICATION}}  # high, medium, low
      masking_strategy: {{MASKING_STRATEGY}}  # hash, encrypt, redact
      retention_policy: {{PII_RETENTION}}

  audit:
    enabled: {{AUDIT_ENABLED}}
    log_reads: {{LOG_READS}}
    log_writes: {{LOG_WRITES}}
    log_deletes: {{LOG_DELETES}}
    retention: {{AUDIT_RETENTION}}

# ============================================================================
# Monitoring & Alerting
# ============================================================================

monitoring:
  metrics:
    - name: row_count
      query: SELECT COUNT(*) FROM {{TABLE_NAME}}
      threshold:
        min: {{MIN_ROWS}}
        max: {{MAX_ROWS}}
      alert_on_breach: true

    - name: growth_rate
      description: Daily growth rate
      threshold:
        max_daily_growth: {{MAX_GROWTH}}
      alert_on_breach: true

    - name: null_rate
      field: {{FIELD_NAME}}
      threshold:
        max: {{MAX_NULL_RATE}}
      alert_on_breach: true

  alerts:
    - name: data_quality_degradation
      condition: {{ALERT_CONDITION}}
      severity: {{ALERT_SEVERITY}}
      notification: {{NOTIFICATION_CHANNEL}}

    - name: schema_drift
      condition: schema_changed
      severity: critical
      notification: {{NOTIFICATION_CHANNEL}}

# ============================================================================
# Testing
# ============================================================================

testing:
  unit_tests:
    - name: test_{{TEST_NAME}}
      description: {{TEST_DESCRIPTION}}
      type: {{TEST_TYPE}}  # schema, constraint, data_quality

  integration_tests:
    - name: test_{{INTEGRATION_TEST}}
      description: {{TEST_DESCRIPTION}}
      dependencies: {{TEST_DEPENDENCIES}}

  data_fixtures:
    - file: {{FIXTURE_FILE}}
      description: {{FIXTURE_DESCRIPTION}}
      records: {{FIXTURE_RECORDS}}

# ============================================================================
# Variable Reference
# ============================================================================
# {{COMPONENT_NAME}} - Name of the data component
# {{API_VERSION}} - Contract version
# {{COMPONENT_DESCRIPTION}} - Brief description
# {{OWNER_TEAM}} - Team responsible for this data
# {{CONTACT_EMAIL}} - Contact email
# {{TAG_1}}, {{TAG_2}} - Classification tags
# {{LAST_UPDATED}} - Last update timestamp
# {{DB_TYPE}} - Database type
# {{DB_NAME}} - Database name
# {{SCHEMA_NAME}} - Schema name
# {{TABLE_NAME}} - Table name
# {{TABLE_DESCRIPTION}} - Table description
# {{TABLE_COLUMNS}} - Additional columns
# {{TABLE_INDEXES}} - Additional indexes
# {{TABLE_CONSTRAINTS}} - Additional constraints
# {{UNIQUE_COLUMNS}} - Columns for unique constraint
# {{FK_COLUMNS}} - Foreign key columns
# {{PARTITIONING_ENABLED}} - Enable partitioning (true/false)
# {{RETENTION_ENABLED}} - Enable retention policy (true/false)
# {{ACCESS_PATTERNS}} - Additional access patterns
# {{VALIDATION_RULES}} - Additional validation rules
# {{TRANSFORMATION_NAME}} - Name of transformation
# {{UPSTREAM_SOURCE}} - Upstream data source
# {{DOWNSTREAM_CONSUMER}} - Downstream consumer
# {{READ_P95}} - P95 read latency SLA
# {{WRITE_P95}} - P95 write latency SLA
# {{PII_FIELD}} - Field containing PII
# {{ENCRYPTION_AT_REST}} - Encryption at rest (true/false)
# {{AUDIT_ENABLED}} - Enable auditing (true/false)

# Usage Notes:
# 1. Replace all {{VARIABLE}} placeholders
# 2. Remove unused sections
# 3. Add domain-specific rules
# 4. Define comprehensive access patterns
# 5. Document all transformations
# 6. Specify SLAs clearly
# 7. Identify PII fields
# 8. Define monitoring thresholds
# 9. Include test fixtures
# 10. Version your contract
